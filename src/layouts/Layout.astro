---
import Header from "@/components/Header.astro";
import SEO from "@/components/SEO.astro";
import Schema from "@/components/Schema.astro";
import CookieConsent from "@/components/CookieConsent.astro";
import "@/styles/global.css";
// @ts-ignore
import '@fontsource-variable/onest';
import Footer from "@/components/Footer.astro";
import Analytics from '@vercel/analytics/astro';
import type { SEOProps } from '@/lib/seo';

export interface Props extends SEOProps {}

const seoProps = Astro.props as Props;

if (!seoProps.canonical) {
  const currentURL = new URL(Astro.request.url);
  seoProps.canonical = `https://iquitostech.com${currentURL.pathname}`;
}
---

<!doctype html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        
        <style>
          @keyframes fadeIn {
            from { 
              opacity: 0; 
              transform: translateY(10px);
            }
            to { 
              opacity: 1; 
              transform: translateY(0);
            }
          }
          
          * {
            box-sizing: border-box;
          }
          
          :root {
            font-family: 'Onest Variable', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color-scheme: dark;
          }
          
          html {
            background-color: #131313;
          }
          
          body {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
          }
          
          .pt-16 { padding-top: 4rem; }
          .text-white { color: rgb(255 255 255); }
          .bg-gray-900 { background-color: rgb(17 24 39); }
          
          img, picture {
            contain: layout;
          }
          
          .group:hover .group-hover\\:scale-105,
          .group:hover .group-hover\\:scale-110 {
            transform: scale(1.05);
            will-change: transform;
          }
          
          [loading="lazy"] {
            content-visibility: auto;
          }
          
          @media (max-width: 1023px) {
            img[fetchpriority="high"] {
              transform: translateZ(0);
              will-change: auto;
            }
          }
        </style>        
        
        <!-- Content Security Policy -->
        <meta http-equiv="Content-Security-Policy" content="
          default-src 'self'; 
          script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com https://analytics.google.com https://accounts.google.com https://apis.google.com https://www.gstatic.com https://www.google.com/recaptcha/ https://www.recaptcha.net; 
          style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://www.gstatic.com; 
          font-src 'self' https://fonts.gstatic.com data:; 
          img-src 'self' data: blob: https: http: https://cms-iquitostech.com https://secure.gravatar.com https://www.gravatar.com https://i0.wp.com https://i1.wp.com https://i2.wp.com; 
          connect-src 'self' https://cms-iquitostech.com https://www.googletagmanager.com https://www.google-analytics.com https://analytics.google.com https://accounts.google.com https://oauth2.googleapis.com https://supabase.co https://*.supabase.co wss://*.supabase.co;
          frame-src 'self' https://accounts.google.com https://www.google.com/recaptcha/ https://www.recaptcha.net;
          object-src 'none';
          base-uri 'self';
          form-action 'self' https://accounts.google.com;
        ">
        
        <link rel="preconnect" href="https://cms-iquitostech.com" crossorigin>
        <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
        
        <link rel="dns-prefetch" href="//news.google.com">
        <link rel="dns-prefetch" href="//iquitostech.wordpress.com">
        <link rel="dns-prefetch" href="//wp-content.com">
        
        <!-- Using local Onest font instead of Google Fonts for better CSP compliance -->
        <style>
          @import '@fontsource-variable/onest/index.css';
          
          :root {
            font-family: 'Onest Variable', sans-serif;
          }
        </style>
        
        <meta name="google-adsense-account" content="ca-pub-7561415153058679">
        
        <SEO {...seoProps} />
        <Schema {...seoProps} />
    </head>
    <body>
        
        <script is:inline>
          document.addEventListener('DOMContentLoaded', () => {
            const skeleton = document.getElementById('content-skeleton');
            const actualContent = document.getElementById('actual-content');
            
            if (skeleton && actualContent) {
              skeleton.style.display = 'block';
              actualContent.style.display = 'none';
              
              setTimeout(() => {
                skeleton.style.display = 'none';
                actualContent.style.display = 'block';
                actualContent.style.animation = 'fadeIn 0.4s ease-in-out';
              }, 400);
            }
          });
        </script>
        
        <Header />
        <main class="pt-16 sm:pt-20 lg:pt-24">
            <div id="adsense-top-banner" class="w-full max-w-4xl mx-auto px-4 mb-8 hidden" style="display: none;">
              <div class="text-center">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-7561415153058679"
                     data-ad-slot="1234567890"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
              </div>
            </div>
            
            <slot />
            
            <div id="adsense-bottom-banner" class="w-full max-w-4xl mx-auto px-4 mt-8 mb-8 hidden" style="display: none;">
              <div class="text-center">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-7561415153058679"
                     data-ad-slot="0987654321"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
              </div>
            </div>
        </main>
        <Footer />
        <CookieConsent />
        <Analytics />
        
        <script is:inline>
          window.addEventListener('load', function() {
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            window.gtag = gtag;
            
            gtag('consent', 'default', {
              analytics_storage: 'denied',
              ad_storage: 'denied',
              ad_user_data: 'denied',
              ad_personalization: 'denied',
              wait_for_update: 500
            });
            
            setTimeout(function() {
              const gaScript = document.createElement('script');
              gaScript.async = true;
              gaScript.src = 'https://www.googletagmanager.com/gtag/js?id=G-XXGSVHTJJL';
              document.head.appendChild(gaScript);
              
              gaScript.onload = function() {
                gtag('js', new Date());
                gtag('config', 'G-XXGSVHTJJL', {
                  anonymize_ip: true,
                  allow_google_signals: false,
                  allow_ad_personalization_signals: false
                });
                
                window.addEventListener('cookieConsentUpdated', function(event) {
                  const consent = event.detail;
                  
                  gtag('consent', 'update', {
                    analytics_storage: consent.analytics ? 'granted' : 'denied',
                    ad_storage: consent.marketing ? 'granted' : 'denied',
                    ad_user_data: consent.marketing ? 'granted' : 'denied',
                    ad_personalization: consent.marketing ? 'granted' : 'denied'
                  });
                });
              };
            }, 100);
          });
        </script>
        
        <script is:inline>
          window.addEventListener('load', function() {
            let iframeTimeout;
            
            window.addIframeTitles = function() {
              clearTimeout(iframeTimeout);
              iframeTimeout = setTimeout(() => {
                const iframes = document.querySelectorAll('iframe:not([title])');
                iframes.forEach((iframe, index) => {
                  const src = iframe.src || '';
                  let title = 'Contenido embebido';
                  
                  if (src.includes('youtube')) title = 'Video de YouTube embebido';
                  else if (src.includes('twitter') || src.includes('x.com')) title = 'Tweet embebido';
                  else if (src.includes('facebook')) title = 'Publicación de Facebook';
                  else if (src.includes('instagram')) title = 'Publicación de Instagram';
                  else if (src.includes('tiktok')) title = 'Video de TikTok';
                  else if (src.includes('google')) title = 'Servicio de Google';
                  else if (src.includes('ads') || src.includes('doubleclick')) title = 'Marco publicitario';
                  else title = `Contenido embebido ${index + 1}`;
                  
                  iframe.setAttribute('title', title);
                  iframe.setAttribute('aria-label', title);
                });
              }, 100);
            };
            
            window.addIframeTitles();
            
            window.iframeObserver = new MutationObserver((mutations) => {
              let hasNewIframes = false;
              mutations.forEach((mutation) => {
                if (mutation.type === 'childList') {
                  mutation.addedNodes.forEach((node) => {
                    if (node.nodeType === 1 && (node.tagName === 'IFRAME' || node.querySelector?.('iframe'))) {
                      hasNewIframes = true;
                    }
                  });
                }
              });
              if (hasNewIframes) window.addIframeTitles();
            });
            
            window.iframeObserver.observe(document.body, { childList: true, subtree: true });
          });
        </script>
        <script is:inline>
          window.addEventListener('load', function() {
            if ('serviceWorker' in navigator && !navigator.serviceWorker.controller) {
              navigator.serviceWorker.register('/sw.js').catch(() => {});
            }
          });
        </script>
        
        <script is:inline>
          window.addEventListener('load', function() {
            setTimeout(function() {
              if (typeof PerformanceObserver !== 'undefined' && window.gtag) {
                const observer = new PerformanceObserver((list) => {
                  list.getEntries().forEach((entry) => {
                    if (entry.entryType === 'largest-contentful-paint' && entry.startTime > 0) {
                      window.gtag('event', 'LCP', { value: Math.round(entry.startTime) });
                    }
                  });
                });
                try {
                  observer.observe({ entryTypes: ['largest-contentful-paint'] });
                } catch (e) {}
              }
            }, 500);
          });
        </script>
        
        <script is:inline>
          window.addEventListener('load', function() {
            setTimeout(() => {
              const swgScript = document.createElement('script');
              swgScript.async = true;
              swgScript.src = 'https://news.google.com/swg/js/v1/swg-basic.js';
              swgScript.onload = function() {
                try {
                  (self.SWG_BASIC = self.SWG_BASIC || []).push(function(basicSubscriptions) {
                    basicSubscriptions.init({
                      type: "NewsArticle",
                      isPartOfType: ["Product"],
                      isPartOfProductId: "CAowoPTcCw:openaccess",
                      clientOptions: { theme: "light", lang: "es" },
                    });
                  });
                } catch (e) {}
              };
              document.head.appendChild(swgScript);
            }, 1000);
          });
        </script>
    </body>
</html>

<style is:global>
    * {
        box-sizing: border-box;
    }
    
    :root {
        font-family: 'Onest Variable', sans-serif;
        color-scheme: dark;
    }
    
    html {
        background-color: #131313;
    }
    
    body {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        min-height: 100vh;
    }
    
    @media (min-width: 640px) {
        body {
            padding: 0 1.5rem;
        }
    }
    
    @media (min-width: 1024px) {
        body {
            padding: 0 2rem;
        }
    }
    
    @media (min-width: 1280px) {
        body {
            padding: 0;
        }
    }
    
    ::-webkit-scrollbar {
        width: 8px;
    }
    ::-webkit-scrollbar-track {
        background: transparent;
        backdrop-filter: blur(10px);
        border-radius: 5px;
    }
    ::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(10px);
        border-radius: 5px;
    }
    ::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.5);
    }
    
    body > *:not(.prose-container) p,
    main > *:not(.prose-container) p,
    section:not(.prose-container) p,
    div:not(.prose-container) p {
        color: rgba(255, 255, 255, 0.9);
        line-height: 1.6;
        margin-bottom: 1em;
        font-weight: 100;
        font-size: 0.875rem;
        letter-spacing: 0.5px;
    }
    
    @media (min-width: 640px) {
        body > *:not(.prose-container) p,
        main > *:not(.prose-container) p,
        section:not(.prose-container) p,
        div:not(.prose-container) p {
            font-size: 1rem;
            line-height: 1.5;
        }
    }
    
    @media (min-width: 1024px) {
        body > *:not(.prose-container) p,
        main > *:not(.prose-container) p,
        section:not(.prose-container) p,
        div:not(.prose-container) p {
            line-height: 1.4;
        }
    }
    
    p strong {
        color: white;
        font-weight: 700;
    }
</style>