---
// filepath: f:\CÃ³digo\Iquitos-Tech\iquitos-tech\src\components\NewsItem.astro
import { getFeaturedPosts } from '@/lib/wp';

// Fetch featured posts from WordPress category 25
const featuredPosts = await getFeaturedPosts({ perPage: 2, categoryId: 25 });
---

<div class="grid grid-cols-1 lg:grid-cols-10 gap-4 lg:gap-6">
  {featuredPosts.map((post: { slug: string; featuredImage?: string; title: string; excerpt?: string }, index: number) => (
    <a 
      href={`/posts/${post.slug}`} 
      class={`
        ${index === 0 ? 'lg:col-span-7' : 'lg:col-span-3'}
        relative rounded-xl
        backdrop-blur-md
        bg-[#1a1a1a] overflow-hidden border border-[#313131] hover:border-[#2847d7] hover:shadow-lg hover:shadow-blue-500/20 transition-all duration-300 ease-in-out group cursor-pointer
        ${index === 0 ? 'h-80 lg:h-[500px]' : 'h-64 lg:h-[500px]'}
      `}
    >
      
      <div class="
        absolute z-10 bottom-0 top-0 w-full h-full
        bg-gradient-to-b from-transparent from-40% to-black/80
      "></div>

      {/* Featured Image with LCP optimization and modern formats */}
      {post.featuredImage && (
        <picture>
          <source 
            srcset={post.featuredImage.replace(/\.(jpg|jpeg|png)$/i, '.webp')} 
            type="image/webp"
            sizes={index === 0 ? "(min-width: 1024px) 700px, 100vw" : "(min-width: 1024px) 300px, 100vw"}
          />
          <img 
            src={post.featuredImage} 
            alt={post.title}
            class="absolute inset-0 w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"
            loading={index === 0 ? "eager" : "lazy"}
            fetchpriority={index === 0 ? "high" : "auto"}
            decoding="async"
            sizes={index === 0 ? "(min-width: 1024px) 700px, 100vw" : "(min-width: 1024px) 300px, 100vw"}
            width={index === 0 ? "700" : "300"}
            height={index === 0 ? "500" : "500"}
          />
        </picture>
      )}

      <div class="relative z-20 flex h-full select-none flex-col justify-end gap-1 p-4 text-lg md:p-6">
        <h2 class={`
          ${index === 0 ? 'text-3xl lg:text-4xl' : 'text-2xl lg:text-3xl'} 
          font-bold text-balance mb-2 lg:mb-4 text-white
        `}>
          {post.title}
        </h2>
        
        {/* Show excerpt only on first post (larger) */}
        {index === 0 && post.excerpt && (
          <p class="text-gray-300 text-base line-clamp-3 mb-4" set:html={post.excerpt} />
        )}
      </div>
    </a>
  ))}
</div>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>