---
import { SEO } from 'astro-seo';
import { generateSEOTags, generateSchemaScript, defaultSEO, siteConfig, optimizeImageForSocialMedia, type SEOProps } from '../lib/seo';

export interface Props extends SEOProps {}

const props = Astro.props as Props;

const seoTags = generateSEOTags({ ...defaultSEO, ...props });
const schemaScript = generateSchemaScript(seoTags.schema);
const socialImage = optimizeImageForSocialMedia(seoTags.ogImage) || 'https://iquitostech.com/fallback-banner.webp';

// Build Twitter optional fields
const twitterExtend: any = {};
if (seoTags.twitterLabel1 && seoTags.twitterData1) {
  twitterExtend.label1 = seoTags.twitterLabel1;
  twitterExtend.data1 = seoTags.twitterData1;
}
if (seoTags.twitterLabel2 && seoTags.twitterData2) {
  twitterExtend.label2 = seoTags.twitterLabel2;
  twitterExtend.data2 = seoTags.twitterData2;
}

// Build Open Graph optional fields
const openGraphOptional: any = {};
if (seoTags.ogType === 'article') {
  openGraphOptional.article = {
    publishedTime: seoTags.articlePublishedTime,
    modifiedTime: seoTags.articleModifiedTime,
    authors: seoTags.articleAuthor ? [seoTags.articleAuthor] : undefined
  };
}
---

<SEO
  title={seoTags.title}
  description={seoTags.description}
  canonical={seoTags.canonical}
  noindex={false}
  nofollow={false}
  robotsProps={{
    noindex: false,
    nofollow: false
  }}
  openGraph={{
    basic: {
      title: seoTags.ogTitle || seoTags.title,
      type: seoTags.ogType || 'website',
      image: socialImage,
      url: seoTags.ogUrl || seoTags.canonical
    },
    optional: {
      description: seoTags.ogDescription || seoTags.description,
      siteName: seoTags.ogSiteName,
      locale: seoTags.ogLocale
    },
    image: {
      url: socialImage,
      width: seoTags.ogImageWidth || 1200,
      height: seoTags.ogImageHeight || 630,
      alt: seoTags.ogTitle || seoTags.title
    },
    ...openGraphOptional
  }}
  twitter={{
    card: 'summary_large_image',
    site: '@IquitosTech',
    creator: '@IquitosTech',
    title: seoTags.ogTitle || seoTags.title,
    description: seoTags.ogDescription || seoTags.description,
    image: socialImage,
    imageAlt: seoTags.ogTitle || seoTags.title,
    ...twitterExtend
  }}
  extend={{
    meta: [
      { name: 'author', content: seoTags.articleAuthor || 'Iquitos Tech' },
      { name: 'language', content: 'es' },
      { name: 'theme-color', content: siteConfig.themeColor },
      { name: 'generator', content: Astro.generator },
      ...(seoTags.keywords ? [{ name: 'keywords', content: seoTags.keywords }] : [])
    ],
    link: [
      { rel: 'icon', type: 'image/svg+xml', href: '/logo.svg' },
      { rel: 'apple-touch-icon', sizes: '180x180', href: '/logo.svg' }
    ]
  }}
/>

{schemaScript && (
  <script type="application/ld+json" set:html={schemaScript}></script>
)}
